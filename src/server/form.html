<form
  id="convert-form"
  style="text-align: left"
  onsubmit="handleSubmit"
>
  <label style="display: block">
    郵便番号：
    <br />
    <input
      style="width: 100%; margin-top: 5px"
      name="postcode"
      value="<?= postcode ?>"
    />
  </label>
  <br />
  <label style="display: block">
    住所：
    <br />
    <input
      style="width: 100%; margin-top: 5px"
      name="address"
      value="<?= address ?>"
    />
  </label>
  <p style="margin-bottom: 5px">名前：</p>
  <p style="margin-bottom: 5px">どちらか選択してください</p>
  <? for (let i = 0; i < names.length; i++) { ?>
  <div style="display: flex; gap: 5px; margin-top: 5px">
    <label>
      <input type="radio" name="select-name" id="name<?= i + 1 ?>"
      <? if(i === 0) { ?>
      checked
      <? } ?>
      />
    </label>
    <label>
      <input
        style="width: 100%"
        name="name<?= i + 1 ?>"
        value="<?= names[i] ?>"
      />
    </label>
  </div>
  <? } ?>
  <label style="display: block; margin-top: 20px">
    電話番号：
    <br />
    <input
      style="width: 100%; margin-top: 5px"
      type="tel"
      name="phone-number"
      value="<?= phoneNumber ?>"
    />
  </label>
  <button
    type="submit"
    style="margin-top: 10px; padding: 3px"
    id="submit-button"
  >
    適用
  </button>
</form>
<script>
  const submitButton = document.querySelector('#convert-form');
  submitButton.addEventListener('submit', handleSubmit);

  function handleSubmit(e) {
    e.preventDefault();

    const form = document.forms[0];
    const formElms = form.querySelectorAll('input');
    const formData = Array.from(formElms).reduce((prev, curr, index, inputs) => {
      switch (curr.name) {
        case 'postcode':
          prev.postcode = curr.value;
          break;

        case 'address':
          prev.address = curr.value;
          break;

        case 'select-name':
          if (curr.checked) {
            const id = curr.id;
            const selectedName = inputs.find((input) => input.name === id);

            prev.name = selectedName.value;
          }
          break;

        case 'phone-number':
          prev.phoneNumber = curr.value;
          break;

        default:
          break;
      }

      return prev;
    }, {});

    const submitBtn = e.target;
    submitBtn.innerHTML = 'Loading...';
    submitBtn.style.cssText = 'font-size: 24px; text-align: center; margin-top: 30%';

    const result = google.script.run
      .withSuccessHandler(() => {
        google.script.host.close();
      })
      .writeFormData(formData);
  }
</script>
